{"version":3,"sources":["../../src/gestures/events.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;uBAQe,SAAS;;;;;;;;AAMxB,IAAM,YAAY,GAAG,CACnB,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,aAAa,CACrD,CAAC;;AAEF,IAAM,YAAY,GAAG,CACnB,WAAW,EAAE,WAAW,EAAE,SAAS,EAAE,UAAU,CAChD,CAAC;;AAEF,IAAM,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BjD,IAAM,cAAc,GAAG,GAAG,CAAC;;AAE3B,IAAM,YAAY,GAAG,GAAG,CAAC;;AAEzB,IAAM,kBAAkB,GAAG,GAAG,CAAC;;AAE/B,IAAM,gBAAgB,GAAG,IAAI,CAAC;;AAE9B,IAAM,YAAY,GAAG,EAAE,GAAG,CAAC,CAAC;;;;;;;qBAOb,qBAAG,SAAS,CAAC,aAAa,CAAC;;AAEnC,SAAS,aAAa,CAAC,EAAE,EAAE,SAAS,EAAE;;AAE3C,MAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,OAAO;;AAE9B,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;AACvB,MAAM,SAAS,GAAG,qBAAG,SAAS,EAAE,CAAC;AACjC,MAAM,OAAO,GAAG,EAAE,CAAC,aAAa,CAAC;AACjC,MAAI,cAAc,GAAG,KAAK,CAAC;AAC3B,MAAI,MAAM,GAAG,CAAC,CAAC;AACf,MAAI,KAAK,YAAA;MAAE,KAAK,YAAA;MAAE,OAAO,YAAA;MAAE,OAAO,YAAA,CAAC;AACnC,MAAI,QAAQ,YAAA;MAAE,SAAS,YAAA;MAAE,MAAM,YAAA,CAAC;;;;;;AAMhC,MAAI,EAAE,CAAC,IAAI,KAAK,YAAY,IAAI,EAAE,CAAC,IAAI,KAAK,WAAW,EAAE;AACvD,QAAM,eAAe,GAAG,CAAC,cAAc,CAAC;AACxC,QAAM,OAAO,GAAG,EAAE,CAAC,IAAI,KAAK,YAAY,CAAC;;AAEzC,gBAAY,CAAC,OAAO,CAAC,CAAC;;AAEtB,QAAI,eAAe,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;GACnC;;;;;;AAMD,WAAS,QAAQ,CAAC,CAAC,EAAE;AACnB,QAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,OAAO;;AAExC,QAAM,OAAO,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;AACnC,WAAO,GAAG,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;AAChC,WAAO,GAAG,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;;AAEhC,aAAS,GAAG,YAAY,EAAE,CAAC;AAC3B,UAAM,EAAE,CAAC;;AAET,aAAS,CAAC,OAAO,CAAC;;AAEhB,UAAI,EAAE,UAAU;AAChB,YAAM,EAAE,CAAC,CAAC,MAAM;KACjB,CAAC,CAAC,CAAC;GACL;;;;;;AAMD,WAAS,OAAO,CAAC,CAAC,EAAE;AAClB,QAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,OAAO;;AAExC,QAAM,OAAO,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;;AAEnC,SAAK,GAAG,OAAO,CAAC,KAAK,CAAC;AACtB,SAAK,GAAG,OAAO,CAAC,KAAK,CAAC;;AAEtB,aAAS,CAAC,OAAO,CAAC;;AAEhB,UAAI,EAAE,SAAS;AACf,YAAM,EAAE,CAAC,CAAC,MAAM;KACjB,CAAC,CAAC,CAAC;GACL;;;;;;AAMD,WAAS,MAAM,CAAC,CAAC,EAAE;AACjB,QAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,OAAO;;;;;AAKxC,QAAI,CAAC,CAAC,SAAS,CAAC,cAAc,EAAE;AAC9B,OAAC,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;KAC9B;;AAED,QAAM,UAAU,GAAG,EAAE,CAAC;AACtB,QAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,QAAM,MAAM,GAAG,OAAO,GAAG,KAAK,CAAC;AAC/B,QAAM,MAAM,GAAG,OAAO,GAAG,KAAK,CAAC;;AAE/B,gBAAY,CAAC,QAAQ,CAAC,CAAC;;AAEvB,QAAI,MAAM,IAAI,CAAC,cAAc,EAAE;AAC7B,gBAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KAC/B;;AAED,QAAI,MAAM,IAAI,cAAc,EAAE;AAC5B,gBAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KAC9B;;AAED,QAAI,MAAM,IAAI,CAAC,cAAc,EAAE;AAC7B,gBAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KAC9B;;AAED,QAAI,MAAM,IAAI,cAAc,EAAE;AAC5B,gBAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KAC5B;;AAED,QAAI,UAAU,CAAC,MAAM,EAAE;AACrB,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,EAAE;AACjD,YAAM,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;;AAE3B,iBAAS,CAAC,OAAO,CAAC;;AAEhB,cAAI,EAAJ,IAAI;AACJ,gBAAM,EAAE,CAAC,CAAC,MAAM;AAChB,kBAAQ,EAAE;AACR,aAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;AACnB,aAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;WACpB;SACF,CAAC,CAAC,CAAC;;AAEJ,uBAAe,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;OAClC;KACF,MAEI;;;;AAIH,UAAI,OAAO,IAAI,KAAK,GAAG,YAAY,IAC5B,OAAO,IAAI,KAAK,GAAG,YAAY,IAC/B,OAAO,IAAI,KAAK,GAAG,YAAY,IAC/B,OAAO,IAAI,KAAK,GAAG,YAAY,EAAE;AACtC,YAAI,SAAS,GAAG,YAAY,GAAG,GAAG,IAAI,CAAC,EAAE;AACvC,cAAM,IAAI,GAAG,MAAM,KAAK,CAAC,IAAI,MAAM,KAAK,CAAC,CAAC,MAAM,GAC5C,WAAW,GACX,KAAK,CAAC;;AAEV,mBAAS,CAAC,OAAO,CAAC;;AAEhB,gBAAI,EAAJ,IAAI;AACJ,kBAAM,EAAE,CAAC,CAAC,MAAM;WACjB,CAAC,CAAC,CAAC;;AAEJ,gBAAM,GAAG,CAAC,CAAC,MAAM,CAAC;SACnB,MAEI,IAAI,SAAS,GAAG,gBAAgB,GAAG,GAAG,IAAI,CAAC,EAAE;AAChD,qBAAS,CAAC,OAAO,CAAC;;AAEhB,kBAAI,EAAE,SAAS;AACf,oBAAM,EAAE,CAAC,CAAC,MAAM;aACjB,CAAC,CAAC,CAAC;;AAEJ,kBAAM,GAAG,CAAC,CAAC,MAAM,CAAC;WACnB;OACF;;AAED,cAAQ,GAAG,UAAU,CAAC,YAAM;AAC1B,uBAAe,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;;AAEjC,cAAM,GAAG,CAAC,CAAC;OACZ,EAAE,kBAAkB,CAAC,CAAC;KACxB;;AAED,aAAS,CAAC,OAAO,CAAC;;AAEhB,UAAI,EAAE,QAAQ;AACd,YAAM,EAAE,CAAC,CAAC,MAAM;KACjB,CAAC,CAAC,CAAC;GACL;;;;;;AAMD,WAAS,SAAS,CAAC,CAAC,EAAE;AACpB,QAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,OAAO;;AAExC,aAAS,CAAC,OAAO,CAAC;;AAEhB,UAAI,EAAE,WAAW;AACjB,YAAM,EAAE,CAAC,CAAC,MAAM;KACjB,CAAC,CAAC,CAAC;;AAEJ,gBAAY,CAAC,QAAQ,CAAC,CAAC;AACvB,UAAM,GAAG,CAAC,CAAC;;AAEX,mBAAe,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;GAClC;;;;;;AAMD,WAAS,OAAO,CAAC,UAAU,EAAE;AAC3B,WAAO,eAAc,EAAE,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;GAC5C;;;;;;AAMD,WAAS,uBAAuB,CAAC,CAAC,EAAE;AAClC,WAAO,CAAC,CAAC,MAAM,KAAK,OAAO,CAAC;GAC7B;;;;;;AAMD,WAAS,YAAY,GAAkB;QAAjB,OAAO,yDAAG,KAAK;;AACnC,QAAI,cAAc,EAAE,OAAO;;AAE3B,QAAI,OAAO,EAAE;AACX,eAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;;;AAGhC,eAAS,CAAC,sBAAsB,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;;AAEzD,eAAS,CAAC,sBAAsB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;;AAEvD,eAAS,CAAC,sBAAsB,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;;AAErD,eAAS,CAAC,sBAAsB,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;KAC5D,MAEI;AACH,eAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;AAChC,eAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;;;AAG/B,eAAS,CAAC,sBAAsB,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;;AAExD,eAAS,CAAC,sBAAsB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;;AAEvD,eAAS,CAAC,sBAAsB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;AACpD,eAAS,CAAC,sBAAsB,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;KACtD;;AAED,kBAAc,GAAG,IAAI,CAAC;GACvB;;;;;;AAMD,WAAS,eAAe,GAAkB;QAAjB,OAAO,yDAAG,KAAK;;AACtC,QAAI,CAAC,cAAc,EAAE,OAAO;;AAE5B,QAAI,OAAO,EAAE;AACX,eAAS,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;;;AAGlC,eAAS,CAAC,yBAAyB,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;;AAE5D,eAAS,CAAC,yBAAyB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;;AAE1D,eAAS,CAAC,yBAAyB,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;;AAExD,eAAS,CAAC,yBAAyB,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;KAC/D,MAEI;AACH,eAAS,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;AAClC,eAAS,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;;;AAGjC,eAAS,CAAC,yBAAyB,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;;AAE3D,eAAS,CAAC,yBAAyB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;;AAE1D,eAAS,CAAC,yBAAyB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;AACvD,eAAS,CAAC,yBAAyB,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;KACzD;;AAED,kBAAc,GAAG,KAAK,CAAC;GACxB;CACF;;;;;;AAMD,SAAS,YAAY,CAAC,EAAE,EAAE;AACxB,MAAI,EAAC,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,OAAO,KAAK,CAAC;;AAE5C,MAAI,CAAC,EAAE,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC;AAC5B,SAAO,EAAE,CAAC,MAAM,KAAK,CAAC,CAAC;CACxB;;;;;;AAMD,SAAS,YAAY,CAAC,EAAE,EAAE;AACxB,SAAO,YAAY,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;CAC3C;;;;;;AAMD,SAAS,eAAe,CAAC,EAAE,EAAE;AAC3B,MAAM,GAAG,GAAG,EAAE,CAAC,SAAS,CAAC;AACzB,SAAO,GAAG,CAAC,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;CACvD;;;;;;AAMD,SAAS,YAAY,GAAG;AACtB,SAAO,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;CAC7B","file":"events.js","sourcesContent":["/**\n * Based on https://github.com/GianlucaGuarini/Tocca.js, MIT license\n */\n\n/**\n * Module dependencies\n */\n\nimport hg from 'mercury';\n\n/**\n *\n */\n\nconst TOUCH_EVENTS = [\n  'touchstart', 'touchmove', 'touchend', 'touchcancel',\n];\n\nconst MOUSE_EVENTS = [\n  'mousedown', 'mousemove', 'mouseup', 'mouseout',\n];\n\nconst EVENTS = TOUCH_EVENTS.concat(MOUSE_EVENTS);\n\n/**\n *\n */\n\n// Some helpers borrowed from https://github.com/WebReflection/ie-touch\n/*const msPointerEnabled = !!navigator.pointerEnabled\n  || navigator.msPointerEnabled;*/ //REF//\n/*const isTouch = (!!('ontouchstart' in window)\n  && navigator.userAgent.indexOf('PhantomJS') < 0)\n  || msPointerEnabled;*/ //REF//\n/*function msEventType(type) {\n  const lo = type.toLowerCase();\n  const ms = `MS${type}`;\n  return navigator.msPointerEnabled ? ms : lo;\n}*/ //REF//\n/*const touchevents = {\n  touchstart: `${msEventType('PointerDown')} touchstart`,\n  touchend: `${msEventType('PointerUp')} touchend`,\n  touchmove: `${msEventType('PointerMove')} touchmove`,\n};*/ //REF//\n\n/**\n *\n */\n\nconst swipeThreshold = 100;\n// Range of time where a tap event could be detected\nconst tapThreshold = 150;\n// Delay needed to detect a double tap\nconst doubletapThreshold = 200;\n// Delay needed to detect a long tap\nconst longtapThreshold = 1000;\n// Touch events boundaries (60px by default)\nconst tapPrecision = 60 / 2;\n// const justTouchEvents = window.JUST_ON_TOUCH_DEVICES || isTouch; //REF//\n\n/**\n *\n */\n\nexport default hg.BaseEvent(handleGesture);\n\nexport function handleGesture(ev, broadcast) {\n  // Ignore other events\n  if (!isKnownEvent(ev)) return;\n\n  const data = this.data;\n  const delegator = hg.Delegator();\n  const _target = ev.currentTarget;\n  let listenersAdded = false; // TODO: Check if can remove this\n  let tapNum = 0;\n  let currX, currY, cachedX, cachedY;\n  let tapTimer, timestamp, target;\n\n  /**\n   *\n   */\n\n  if (ev.type === 'touchstart' || ev.type === 'mousedown') {\n    const triggerTapStart = !listenersAdded;\n    const isTouch = ev.type === 'touchstart';\n\n    addListeners(isTouch);\n\n    if (triggerTapStart) tapStart(ev);\n  }\n\n  /**\n   *\n   */\n\n  function tapStart(e) {\n    if (!triggeredOnBoundElement(e)) return;\n\n    const pointer = getPointerEvent(e);\n    cachedX = currX = pointer.pageX;\n    cachedY = currY = pointer.pageY;\n\n    timestamp = getTimestamp();\n    tapNum++;\n\n    broadcast(addData({\n      // _rawEvent: e, //REF//\n      type: 'tapstart',\n      target: e.target,\n    }));\n  }\n\n  /**\n   *\n   */\n\n  function tapMove(e) {\n    if (!triggeredOnBoundElement(e)) return;\n\n    const pointer = getPointerEvent(e);\n\n    currX = pointer.pageX;\n    currY = pointer.pageY;\n\n    broadcast(addData({\n      // _rawEvent: e, //REF//\n      type: 'tapmove',\n      target: e.target,\n    }));\n  }\n\n  /**\n   *\n   */\n\n  function tapEnd(e) {\n    if (!triggeredOnBoundElement(e)) return;\n\n    // This leads to a warning on Chrome,\n    // but is required to not fire both touchstart\n    // and mousedown events on touch devices\n    if (e._rawEvent.preventDefault) {\n      e._rawEvent.preventDefault();\n    }\n\n    const eventTypes = [];\n    const now = getTimestamp();\n    const deltaX = cachedX - currX;\n    const deltaY = cachedY - currY;\n\n    clearTimeout(tapTimer);\n\n    if (deltaX <= -swipeThreshold) {\n      eventTypes.push('swiperight');\n    }\n\n    if (deltaX >= swipeThreshold) {\n      eventTypes.push('swipeleft');\n    }\n\n    if (deltaY <= -swipeThreshold) {\n      eventTypes.push('swipedown');\n    }\n\n    if (deltaY >= swipeThreshold) {\n      eventTypes.push('swipeup');\n    }\n\n    if (eventTypes.length) {\n      for (let i = 0, l = eventTypes.length; i < l; ++i) {\n        const type = eventTypes[i];\n\n        broadcast(addData({\n          // _rawEvent: e, //REF//\n          type,\n          target: e.target,\n          distance: {\n            x: Math.abs(deltaX),\n            y: Math.abs(deltaY),\n          },\n        }));\n\n        removeListeners(isTouchEvent(e));\n      }\n    }\n\n    else {\n      // TODO: \"longtap\" prevents normal \"tap\",\n      // maybe it's better to trigger also \"tap\",\n      // along with \"longtap\" event\n      if (cachedX >= currX - tapPrecision\n          && cachedX <= currX + tapPrecision\n          && cachedY >= currY - tapPrecision\n          && cachedY <= currY + tapPrecision) {\n        if (timestamp + tapThreshold - now >= 0) {\n          const type = tapNum === 2 && target === e.target\n            ? 'doubletap'\n            : 'tap';\n\n          broadcast(addData({\n            // _rawEvent: e, //REF//\n            type,\n            target: e.target,\n          }));\n\n          target = e.target; // TOOD: Check if can remove this\n        }\n\n        else if (timestamp + longtapThreshold - now <= 0) {\n          broadcast(addData({\n            // _rawEvent: e, //REF//\n            type: 'longtap',\n            target: e.target,\n          }));\n\n          target = e.target; // TOOD: Check if can remove this\n        }\n      }\n\n      tapTimer = setTimeout(() => {\n        removeListeners(isTouchEvent(e));\n\n        tapNum = 0;\n      }, doubletapThreshold);\n    }\n\n    broadcast(addData({\n      // _rawEvent: e, //REF//\n      type: 'tapend',\n      target: e.target,\n    }));\n  }\n\n  /**\n   *\n   */\n\n  function tapCancel(e) {\n    if (!triggeredOnBoundElement(e)) return;\n\n    broadcast(addData({\n      // _rawEvent: e, //REF//\n      type: 'tapcancel',\n      target: e.target,\n    }));\n\n    clearTimeout(tapTimer);\n    tapNum = 0;\n\n    removeListeners(isTouchEvent(e));\n  }\n\n  /**\n   *\n   */\n\n  function addData(additional) {\n    return Object.assign({}, data, additional);\n  }\n\n  /**\n   *\n   */\n\n  function triggeredOnBoundElement(e) {\n    return e.target === _target;\n  }\n\n  /**\n   *\n   */\n\n  function addListeners(isTouch = false) {\n    if (listenersAdded) return;\n\n    if (isTouch) {\n      delegator.listenTo('touchmove');\n\n      // TOOD: Check if can remove this\n      delegator.addGlobalEventListener('touchstart', tapStart);\n\n      delegator.addGlobalEventListener('touchmove', tapMove);\n\n      delegator.addGlobalEventListener('touchend', tapEnd);\n\n      delegator.addGlobalEventListener('touchcancel', tapCancel);\n    }\n\n    else {\n      delegator.listenTo('mousemove');\n      delegator.listenTo('mouseout');\n\n      // TOOD: Check if can remove this\n      delegator.addGlobalEventListener('mousedown', tapStart);\n\n      delegator.addGlobalEventListener('mousemove', tapMove);\n\n      delegator.addGlobalEventListener('mouseup', tapEnd);\n      delegator.addGlobalEventListener('mouseout', tapEnd);\n    }\n\n    listenersAdded = true;\n  }\n\n  /**\n   *\n   */\n\n  function removeListeners(isTouch = false) {\n    if (!listenersAdded) return;\n\n    if (isTouch) {\n      delegator.unlistenTo('touchmove');\n\n      // TOOD: Check if can remove this\n      delegator.removeGlobalEventListener('touchstart', tapStart);\n\n      delegator.removeGlobalEventListener('touchmove', tapMove);\n\n      delegator.removeGlobalEventListener('touchend', tapEnd);\n\n      delegator.removeGlobalEventListener('touchcancel', tapCancel);\n    }\n\n    else {\n      delegator.unlistenTo('mousemove');\n      delegator.unlistenTo('mouseout');\n\n      // TOOD: Check if can remove this\n      delegator.removeGlobalEventListener('mousedown', tapStart);\n\n      delegator.removeGlobalEventListener('mousemove', tapMove);\n\n      delegator.removeGlobalEventListener('mouseup', tapEnd);\n      delegator.removeGlobalEventListener('mouseout', tapEnd);\n    }\n\n    listenersAdded = false;\n  }\n}\n\n/**\n *\n */\n\nfunction isKnownEvent(ev) {\n  if (!~EVENTS.indexOf(ev.type)) return false;\n\n  if (!ev.button) return true;\n  return ev.button === 1;\n}\n\n/**\n *\n */\n\nfunction isTouchEvent(ev) {\n  return TOUCH_EVENTS.indexOf(ev.type) > -1;\n}\n\n/**\n *\n */\n\nfunction getPointerEvent(ev) {\n  const raw = ev._rawEvent;\n  return raw.targetTouches ? raw.targetTouches[0] : raw;\n}\n\n/**\n *\n */\n\nfunction getTimestamp() {\n  return new Date().getTime();\n}\n"]}